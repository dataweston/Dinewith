generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

enum UserRole {
  GUEST
  HOST
  MODERATOR
  ADMIN
}

enum HostApplicationStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
}

enum KycStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  FAILED
}

model User {
  id               String             @id @default(cuid())
  email            String             @unique
  name             String?
  password         String
  salt             String
  role             UserRole           @default(GUEST)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  hostApplications HostApplication[]
}

model HostApplication {
  id               String                 @id @default(cuid())
  userId           String
  user             User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Basic Info
  businessName     String?
  phone            String?
  bio              String?
  experienceYears  Int?
  cuisineTypes     String[]               @default([])
  
  // Location
  address          String?
  city             String?
  state            String?
  zipCode          String?
  
  // KYC & Verification
  kycStatus        KycStatus              @default(NOT_STARTED)
  kycStartedAt     DateTime?
  kycCompletedAt   DateTime?
  kycData          String?                // JSON blob for KYC metadata
  
  // Application Status
  status           HostApplicationStatus  @default(DRAFT)
  submittedAt      DateTime?
  reviewedAt       DateTime?
  reviewedBy       String?                // User ID of moderator
  reviewNotes      String?
  
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  
  @@index([userId])
  @@index([status])
}

enum WaitlistStatus {
  PENDING
  CONTACTED
}

model City {
  id              String          @id @default(cuid())
  name            String
  slug            String          @unique
  stateName       String
  stateSlug       String
  stateCode       String
  headline        String?
  description     String?
  heroCopy        String?
  heroImage       String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  waitlistEntries WaitlistEntry[]

  @@index([stateSlug])
}

model WaitlistEntry {
  id        String          @id @default(cuid())
  email     String
  name      String?
  guests    Int?
  notes     String?
  source    String?         @default("city-landing")
  status    WaitlistStatus  @default(PENDING)
  cityId    String
  city      City            @relation(fields: [cityId], references: [id], onDelete: Cascade)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt

  @@unique([email, cityId])
}
